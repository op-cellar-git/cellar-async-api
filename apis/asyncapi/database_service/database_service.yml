# database_service.yml
asyncapi: 2.0.0
info:
  title: Database Service API
  version: '0.1'
  description: Definition of the Database Service API
servers:
  production:
    # the server is just a placeholder at the moment
    url: broker.cellar.com
    protocol: amqp
    description: AsyncMessage Broker

channels:
  # how to integrate api versioning?
  sec/IngestBegin:
    publish:
      message: 
        $ref: 'https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/database_service/database_service_components.yml#/components/messages/IngestBegin'
  database/IngestEnd:
    subscribe:
      message:
         $ref: 'https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/database_service/database_service_components.yml#/components/messages/IngestEnd'
  database/IngestFail:
    subscribe:
      message:
         $ref: 'https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/database_service/database_service_components.yml#/components/messages/IngestFail'
  sec/CompensateBegin:
    publish:
      message: 
        $ref: 'https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/database_service/database_service_components.yml#/components/messages/CompensateBegin'
  validation/CompensateEnd:
    subscribe:
      message:
         $ref: 'https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/database_service/database_service_components.yml#/components/messages/CompensateEnd'
  validation/CompensateFail:
    subscribe:
      message:
         $ref: 'https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/database_service/database_service_components.yml#/components/messages/CompensateFail'
  sec/SnapshotDbBegin:
    publish:
      message: 
        $ref: 'https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/database_service/database_service_components.yml#/components/messages/SnapshotDbBegin'
  validation/SnapshotDbEnd:
    subscribe:
      message:
         $ref: 'https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/database_service/database_service_components.yml#/components/messages/SnapshotDbEnd'
  validation/SnapshotDbFail:
    subscribe:
      message:
         $ref: 'https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/database_service/database_service_components.yml#/components/messages/SnapshotDbFail'
  sec/CleanupBegin:
    publish:
      message: 
        $ref: 'https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/database_service/database_service_components.yml#/components/messages/CleanupBegin'   
  validation/CleanupEnd:
    subscribe:
      message:
         $ref: 'https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/database_service/database_service_components.yml#/components/messages/CleanupEnd'
  validation/CleanupFail:
    subscribe:
      message:
         $ref: 'https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/database_service/database_service_components.yml#/components/messages/CleanupFail'
         
