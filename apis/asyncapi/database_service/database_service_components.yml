# validation_service_components.yml
components:
  messages:
    IngestBegin:
      correlationId:
        $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      #correlationId:
      #  $ref: "#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/IngestBeginPayloadSchema"
    CompensateBegin:
      correlationId:
       $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/CompensateBeginPayloadSchema" 
    SnapshotDbBegin:
      correlationId:
        $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/SnapshotDbBeginPayloadSchema"      
    CleanupBegin:
      correlationId:
        $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/CleanupBeginPayloadSchema"      
    # end
    IngestEnd:
      correlationId:
        $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/IngestEndPayloadSchema"
    CompensateEnd:
      correlationId:
       $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/CompensateEndPayloadSchema" 
    SnapshotDbEnd:
      correlationId:
        $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/SnapshotDbEndPayloadSchema"      
    CleanupEnd:
      correlationId:
       $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/CleanupEndPayloadSchema"     
    # fail
    IngestFail:
      correlationId:
        $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/IngestFailPayloadSchema"
    CompensateFail:
      correlationId:
        $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/CompensateFailPayloadSchema" 
    SnapshotDbFail:
      correlationId:
        $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/SnapshotDbFailPayloadSchema"      
    CleanupFail:
      correlationId:
        $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/CleanupFailPayloadSchema"              

  schemas:
    IngestBeginPayloadSchema:
      type: object
      properties:
        traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 
        db:
          $ref: "#/components/schemas/dbSchema"
        sharedAreaRef: 
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/sharedAreaRefSchema"
      required:
      - traceId
      - db
      - sharedAreaRef
    IngestEndPayloadSchema:
      type: object
      properties:
        traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 
      required:
      - traceId
    IngestFailPayloadSchema:
      type: object
      properties:
        traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 
      required:
      - traceId
    CompensateBeginPayloadSchema:
      type: object
      properties:
        traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 
        db:
          $ref: "#/components/schemas/dbSchema"
        sharedAreaRef: 
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/sharedAreaRefSchema"
      required:
      - traceId
      - db
      - sharedAreaRef
    CompensateEndPayloadSchema:
      type: object
      properties:
        traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 
      required:
      - traceId
    CompensateFailPayloadSchema:
      type: object
      properties:
        traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 
      required:
      - traceId
    SnapshotDbBeginPayloadSchema:
      type: object
      properties:
        traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 
        sharedAreaRef: 
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/sharedAreaRefSchema"

    SnapshotDbEndPayloadSchema:
      type: object
      properties:
       traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 
    SnapshotDbFailPayloadSchema:
      type: object
      properties:
        traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 
    CleanupBeginPayloadSchema:
      type: object
      properties:
        traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 
        sharedAreaRef: 
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/sharedAreaRefSchema"

    CleanupEndPayloadSchema:
      type: object
      properties:
       traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 
    CleanupFailPayloadSchema:
      type: object
      properties:
        traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 

    dbSchema:
     type: string
     description: The affected database.
     enum:
     - s3
     - es
     - virtuoso
     - rdbms