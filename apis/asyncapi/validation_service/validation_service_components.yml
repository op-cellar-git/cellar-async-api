# database_service_components.yml
components:
  messages:
    # begin
    PrelockValidationBegin:
      correlationId:
        $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/PrelockValidationBeginPayloadSchema"
    PostlockValidationBegin:
      correlationId:
        $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/PostlockValidationBeginPayloadSchema"     
    # end
    PrelockValidationEnd:
      correlationId:
        $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/PrelockValidationEndPayloadSchema"
    PostlockValidationEnd:
      correlationId:
        $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/PostlockValidationEndPayloadSchema"   
    # fail
    PrelockValidationFail:
      correlationId:
        $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/PrelockValidationFailPayloadSchema"
    PostlockValidationFail:
      correlationId:
        $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/correlationIds/traceIdCorrelator"
      payload:
        $ref: "#/components/schemas/PostlockValidationFailPayloadSchema"           

  schemas:
    PrelockValidationBeginPayloadSchema:
      type: object
      properties:
        traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 
        sharedAreaRef: 
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/sharedAreaRefSchema"
    PrelockValidationEndPayloadSchema:
      type: object
      properties:
        traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 
    PrelockValidationFailPayloadSchema:
      type: object
      properties:
        traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 
          
    PostlockValidationBeginPayloadSchema:
      type: object
      properties:
        # there seems to be built-in support in asyncapi for correlationIds. 
        # see https://www.asyncapi.com/docs/specifications/2.0.0/#correlationIdObject
        traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 
        sharedAreaRef: 
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/sharedAreaRefSchema"
    PostlockValidationEndPayloadSchema:
      type: object
      properties:
        traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 
    PostlockValidationFailPayloadSchema:
      type: object
      properties:
        traceId:
          $ref: "https://raw.githubusercontent.com/op-cellar-git/cellar-transaction/master/apis/asyncapi/shared_components/shared_components.yml#/components/schemas/traceIdSchema" 